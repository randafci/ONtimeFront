<div class="card">
  <!-- Header Section -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-semibold text-gray-800">{{ (isEditMode ? 'employees.formPage.titles.edit' : 'employees.formPage.titles.add') | translate }}</h1>
    <button 
      pButton 
      [label]="'employees.formPage.buttons.back' | translate"
      class="p-button-danger" 
      icon="pi pi-arrow-left"
      (click)="onBack()">
    </button>
  </div>

  <!-- Employee Profile Overview -->
  <div class="employee-profile-section mb-8 p-6 bg-gray-50 rounded-lg">
    <div class="flex flex-col items-center text-center">
      <!-- Profile Picture Upload -->
      <div class="relative mb-4">
        <div 
          class="w-24 h-24 bg-gray-200 rounded-full flex items-center justify-center border-4 border-white shadow-lg cursor-pointer hover:bg-gray-300 transition-colors"
          (click)="fileInput.click()">
          <!-- Show uploaded image if available -->
          <img 
            *ngIf="profileImageUrl" 
            [src]="profileImageUrl" 
            [alt]="'employees.formPage.profile.alt' | translate"
            class="w-full h-full rounded-full object-cover">
          <!-- Show default icon if no image -->
          <i 
            *ngIf="!profileImageUrl" 
            class="pi pi-user text-4xl text-gray-400"></i>
        </div>
        <!-- Upload overlay -->
        <div 
          class="absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity cursor-pointer"
          (click)="fileInput.click()">
          <i class="pi pi-camera text-white text-xl"></i>
        </div>
        <!-- Remove image button -->
        <button 
          *ngIf="profileImageUrl"
          type="button"
          class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors"
          (click)="removeImage($event)">
          <i class="pi pi-times text-xs"></i>
        </button>
        <!-- Hidden file input -->
        <input 
          #fileInput
          type="file" 
          accept="image/*"
          (change)="onImageUpload($event)"
          class="hidden">
      </div>
      <div class="text-center">
        <h3 class="text-xl font-semibold text-gray-900 mb-1">{{ fullName || ('employees.formPage.profile.fullName' | translate) }}</h3>
        <p class="text-gray-600 text-lg mb-2">{{ jobTitle || ('employees.formPage.profile.jobTitle' | translate) }}</p>
        <div class="flex items-center justify-center gap-4">
          <span class="text-sm text-gray-500">{{ 'employees.formPage.profile.employeeId' | translate }}: {{ employeeForm.get('employeeCode')?.value || 'N/A' }}</span>
          <span class="text-sm text-gray-500">{{ 'employees.formPage.profile.status' | translate }}: {{ employeeForm.get('employeeStatus')?.value || ('employees.listPage.statuses.active' | translate) }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation Tabs -->
  <div class="tabs-navigation mb-6">
    <div class="border-b border-gray-200">
      <nav class="flex space-x-8">
        <button 
          class="tab-button py-2 px-1 border-b-2 font-medium text-sm"
          [class.active]="activeTabIndex === 0"
          (click)="onTabChange(0)">
          <i class="pi pi-user mr-2"></i>
          {{ 'employees.formPage.tabs.general' | translate }}
        </button>
        <button 
          class="tab-button py-2 px-1 border-b-2 font-medium text-sm"
          [class.active]="activeTabIndex === 1"
          (click)="onTabChange(1)">
          <i class="pi pi-phone mr-2"></i>
          {{ 'employees.formPage.tabs.contact' | translate }}
        </button>
        <button 
          class="tab-button py-2 px-1 border-b-2 font-medium text-sm"
          [class.active]="activeTabIndex === 2"
          (click)="onTabChange(2)">
          <i class="pi pi-building mr-2"></i>
          {{ 'employees.formPage.tabs.organizational' | translate }}
        </button>
        <button 
          class="tab-button py-2 px-1 border-b-2 font-medium text-sm"
          [class.active]="activeTabIndex === 3"
          (click)="onTabChange(3)">
          <i class="pi pi-file mr-2"></i>
          {{ 'employees.formPage.tabs.documents' | translate }}
        </button>
        <button 
          class="tab-button py-2 px-1 border-b-2 font-medium text-sm"
          [class.active]="activeTabIndex === 4"
          (click)="onTabChange(4)">
          <i class="pi pi-users mr-2"></i>
          {{ 'employees.formPage.tabs.reportManagers' | translate }}
        </button>
        <button 
          class="tab-button py-2 px-1 border-b-2 font-medium text-sm"
          [class.active]="activeTabIndex === 5"
          (click)="onTabChange(5)">
          <i class="pi pi-calendar mr-2"></i>
          {{ 'employees.formPage.tabs.assignSchedule' | translate }}
        </button>
        <button 
          class="tab-button py-2 px-1 border-b-2 font-medium text-sm"
          [class.active]="activeTabIndex === 6"
          (click)="onTabChange(6)">
          <i class="pi pi-shield mr-2"></i>
          {{ 'employees.formPage.tabs.policies' | translate }}
        </button>
      </nav>
    </div>
  </div>

  <!-- Tab Content -->
  <form [formGroup]="employeeForm" (ngSubmit)="onSubmit()">
    
    <!-- General Tab -->
    <div *ngIf="activeTabIndex === 0" class="tab-content">
      <h3 class="text-lg font-medium mb-6 text-gray-900 text-center">{{ 'employees.formPage.general.title' | translate }}</h3>
      
      <!-- Employment Information Section -->
      <div class="mb-8">
        <h4 class="text-md font-semibold mb-4 text-gray-800 border-b pb-2">{{ 'employees.formPage.general.employmentSection' | translate }}</h4>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="field">
            <label for="employeeCode" class="block text-sm font-medium mb-2 text-gray-700">
              {{ 'employees.formPage.general.labels.employeeId' | translate }} <span class="text-red-500">*</span>
            </label>
            <input 
              id="employeeCode"
              pInputText 
              formControlName="employeeCode"
              [placeholder]="'employees.formPage.placeholders.employeeId' | translate"
              class="w-full"
              [class.ng-invalid]="employeeForm.get('employeeCode')?.invalid && employeeForm.get('employeeCode')?.touched">
            <small class="text-red-500" *ngIf="employeeForm.get('employeeCode')?.invalid && employeeForm.get('employeeCode')?.touched">
              {{ 'employees.formPage.validation.required' | translate }}
            </small>
          </div>

          <div class="field">
            <label for="employeeStatus" class="block text-sm font-medium mb-2 text-gray-700">
              {{ 'employees.formPage.general.labels.employeeStatus' | translate }}
            </label>
            <p-select 
              id="employeeStatus"
              formControlName="employeeStatus"
              [options]="employeeStatusOptions"
              [placeholder]="'employees.formPage.placeholders.selectStatus' | translate"
              optionLabel="label"
              optionValue="value"
              class="w-full">
            </p-select>
          </div>

          <div class="field">
            <label for="employeeType" class="block text-sm font-medium mb-2 text-gray-700">
              {{ 'employees.formPage.general.labels.employeeType' | translate }}</label>
          
            <input 
              id="employeeType"
              pInputText 
              formControlName="employeeType"
              [placeholder]="'employees.formPage.placeholders.employeeType' | translate"
              class="w-full">
          </div>
        </div>
      </div>

      <!-- Personal Information Section -->
      <div class="mb-8">
        <h4 class="text-md font-semibold mb-4 text-gray-800 border-b pb-2">{{ 'employees.formPage.general.personalSection' | translate }}</h4>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="field">
            <label for="firstName" class="block text-sm font-medium mb-2 text-gray-700">
              {{ 'employees.formPage.general.labels.firstName' | translate }} <span class="text-red-500">*</span>
            </label>
            <input 
              id="firstName"
              pInputText 
              formControlName="firstName"
              [placeholder]="'employees.formPage.placeholders.firstName' | translate"
              class="w-full"
              [class.ng-invalid]="employeeForm.get('firstName')?.invalid && employeeForm.get('firstName')?.touched">
            <small class="text-red-500" *ngIf="employeeForm.get('firstName')?.invalid && employeeForm.get('firstName')?.touched">
              {{ 'employees.formPage.validation.required' | translate }}
            </small>
          </div>

          <div class="field">
            <label for="lastName" class="block text-sm font-medium mb-2 text-gray-700">
              {{ 'employees.formPage.general.labels.familyName' | translate }} <span class="text-red-500">*</span>
            </label>
            <input 
              id="lastName"
              pInputText 
              formControlName="lastName"
              [placeholder]="'employees.formPage.placeholders.familyName' | translate"
              class="w-full"
              [class.ng-invalid]="employeeForm.get('lastName')?.invalid && employeeForm.get('lastName')?.touched">
            <small class="text-red-500" *ngIf="employeeForm.get('lastName')?.invalid && employeeForm.get('lastName')?.touched">
              {{ 'employees.formPage.validation.required' | translate }}
            </small>
          </div>

          <div class="field">
            <label for="gender" class="block text-sm font-medium mb-2 text-gray-700">
              {{ 'employees.formPage.general.labels.gender' | translate }} <span class="text-red-500">*</span>
            </label>
            <p-select 
              id="gender"
              formControlName="gender"
              [options]="genderOptions" 
              optionLabel="label" 
              optionValue="value"
              [placeholder]="'employees.formPage.placeholders.selectGender' | translate"
              class="w-full"
              [class.ng-invalid]="employeeForm.get('gender')?.invalid && employeeForm.get('gender')?.touched">
            </p-select>
            <small class="text-red-500" *ngIf="employeeForm.get('gender')?.invalid && employeeForm.get('gender')?.touched">
              {{ 'employees.formPage.validation.required' | translate }}
            </small>
          </div>

          <div class="field">
            <label for="nationality" class="block text-sm font-medium mb-2 text-gray-700">
              {{ 'employees.formPage.general.labels.nationality' | translate }}
            </label>
            <input 
              id="nationality"
              pInputText 
              formControlName="nationality"
              [placeholder]="'employees.formPage.placeholders.nationality' | translate"
              class="w-full">
          </div>

          <div class="field">
            <label for="religionType" class="block text-sm font-medium mb-2 text-gray-700">
              {{ 'employees.formPage.general.labels.religion' | translate }}
            </label>
            <input 
              id="religionType"
              pInputText 
              formControlName="religionType"
              [placeholder]="'employees.formPage.placeholders.religion' | translate"
              class="w-full">
          </div>

          <div class="field">
            <label for="isSpecialNeeds" class="block text-sm font-medium mb-2 text-gray-700">
              {{ 'employees.formPage.general.labels.specialNeeds' | translate }}
            </label>
            <div class="flex items-center">
              <input 
                type="checkbox"
                id="isSpecialNeeds"
                formControlName="isSpecialNeeds"
                class="mr-3 h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded">
              <label for="isSpecialNeeds" class="text-sm text-gray-700">{{ 'employees.formPage.general.labels.enableSpecialNeeds' | translate }}</label>
            </div>
          </div>
        </div>
      </div>

      <!-- Display Settings Section -->
      <div>
        <h4 class="text-md font-semibold mb-4 text-gray-800 border-b pb-2">{{ 'employees.formPage.general.displaySection' | translate }}</h4>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="field">
            <label for="displayInReport" class="block text-sm font-medium mb-2 text-gray-700">
              {{ 'employees.formPage.general.labels.displayInReport' | translate }}
            </label>
            <div class="flex items-center">
              <input 
                type="checkbox"
                id="displayInReport"
                formControlName="displayInReport"
                class="mr-3 h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded">
              <label for="displayInReport" class="text-sm text-gray-700">{{ 'employees.formPage.general.labels.showInReports' | translate }}</label>
            </div>
          </div>

          <div class="field">
            <label for="displayInReportsDashboard" class="block text-sm font-medium mb-2 text-gray-700">
              {{ 'employees.formPage.general.labels.displayInDashboard' | translate }}
            </label>
            <div class="flex items-center">
              <input 
                type="checkbox"
                id="displayInReportsDashboard"
                formControlName="displayInReportsDashboard"
                class="mr-3 h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded">
              <label for="displayInReportsDashboard" class="text-sm text-gray-700">{{ 'employees.formPage.general.labels.showInDashboard' | translate }}</label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Contact Tab -->
    <div *ngIf="activeTabIndex === 1" class="tab-content">
      <div class="mb-6">
        <!-- Contact Details Section -->
        <div class="text-center mb-8">
          <h3 class="text-lg font-medium text-gray-900">{{ 'employees.formPage.contact.title' | translate }}</h3>
        </div>

                 <!-- Personal Contact Information -->
         <div class="mb-8">
           <h4 class="text-md font-semibold mb-4 text-gray-800 border-b pb-2">{{ 'employees.formPage.contact.personalSection' | translate }}</h4>
           <div formGroupName="contact" class="grid grid-cols-1 md:grid-cols-3 gap-8">
             
             <!-- Personal Email -->
             <div class="field">
               <label for="personalEmail" class="block text-sm font-medium mb-2 text-gray-700">
                 {{ 'employees.formPage.contact.labels.personalEmail' | translate }}
               </label>
               <input 
                 id="personalEmail"
                 pInputText 
                 formControlName="personalEmail"
                 [placeholder]="'employees.formPage.placeholders.personalEmail' | translate"
                 class="w-full">
             </div>

             <!-- Personal Phone -->
             <div class="field">
               <label for="personalPhone" class="block text-sm font-medium mb-2 text-gray-700">
                 {{ 'employees.formPage.contact.labels.personalPhone' | translate }}
               </label>
               <input 
                 id="personalPhone"
                 pInputText 
                 formControlName="personalPhone"
                 [placeholder]="'employees.formPage.placeholders.personalPhone' | translate"
                 class="w-full">
             </div>

             <!-- Personal Mobile -->
             <div class="field">
               <label for="personalMobile" class="block text-sm font-medium mb-2 text-gray-700">
                 {{ 'employees.formPage.contact.labels.personalMobile' | translate }}
               </label>
               <input 
                 id="personalMobile"
                 pInputText 
                 formControlName="personalMobile"
                 [placeholder]="'employees.formPage.placeholders.personalMobile' | translate"
                 class="w-full">
             </div>
           </div>
         </div>

                 <!-- Official Contact Information -->
         <div class="mb-8">
           <h4 class="text-md font-semibold mb-4 text-gray-800 border-b pb-2">{{ 'employees.formPage.contact.officialSection' | translate }}</h4>
           <div formGroupName="contact" class="grid grid-cols-1 md:grid-cols-3 gap-8">
             
             <!-- Official Email -->
             <div class="field">
               <label for="officialEmail" class="block text-sm font-medium mb-2 text-gray-700">
                 {{ 'employees.formPage.contact.labels.officialEmail' | translate }}
               </label>
               <input 
                 id="officialEmail"
                 pInputText 
                 formControlName="officialEmail"
                 [placeholder]="'employees.formPage.placeholders.officialEmail' | translate"
                 class="w-full">
             </div>

             <!-- Official Phone -->
             <div class="field">
               <label for="officialPhone" class="block text-sm font-medium mb-2 text-gray-700">
                 {{ 'employees.formPage.contact.labels.officialPhone' | translate }}
               </label>
               <input 
                 id="officialPhone"
                 pInputText 
                 formControlName="officialPhone"
                 [placeholder]="'employees.formPage.placeholders.officialPhone' | translate"
                 class="w-full">
               </div>

             <!-- Official Mobile -->
             <div class="field">
               <label for="officialMobile" class="block text-sm font-medium mb-2 text-gray-700">
                 {{ 'employees.formPage.contact.labels.officialMobile' | translate }}
               </label>
               <input 
                 id="officialMobile"
                 pInputText 
                 formControlName="officialMobile"
                 [placeholder]="'employees.formPage.placeholders.officialMobile' | translate"
                 class="w-full">
             </div>
           </div>
         </div>

                 <!-- Address Information -->
         <div class="mb-8">
           <h4 class="text-md font-semibold mb-4 text-gray-800 border-b pb-2">{{ 'employees.formPage.contact.addressSection' | translate }}</h4>
           <div formGroupName="contact" class="grid grid-cols-1 md:grid-cols-3 gap-8">
             
             <!-- Address -->
             <div class="field md:col-span-3">
               <label for="address" class="block text-sm font-medium mb-2 text-gray-700">
                 {{ 'employees.formPage.contact.labels.address' | translate }}
               </label>
               <input 
                 id="address"
                 pInputText 
                 formControlName="address"
                 [placeholder]="'employees.formPage.placeholders.address' | translate"
                 class="w-full">
             </div>

             <!-- City -->
             <div class="field">
               <label for="city" class="block text-sm font-medium mb-2 text-gray-700">
                 {{ 'employees.formPage.contact.labels.city' | translate }}
               </label>
               <input 
                 id="city"
                 pInputText 
                 formControlName="city"
                 [placeholder]="'employees.formPage.placeholders.city' | translate"
                 class="w-full">
             </div>

             <!-- State -->
             <div class="field">
               <label for="state" class="block text-sm font-medium mb-2 text-gray-700">
                 {{ 'employees.formPage.contact.labels.state' | translate }}
               </label>
               <input 
                 id="state"
                 pInputText 
                 formControlName="state"
                 [placeholder]="'employees.formPage.placeholders.state' | translate"
                 class="w-full">
             </div>
           </div>
         </div>
      </div>
    </div>

    <!-- Organizational Tab -->
    <div *ngIf="activeTabIndex === 2" class="tab-content">
      <div class="text-center py-12">
        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="pi pi-building text-2xl text-gray-400"></i>
        </div>
        <h3 class="text-lg font-medium text-gray-900 mb-2">{{ 'employees.formPage.tabs.organizational' | translate }}</h3>
        <p class="text-gray-500">{{ 'employees.formPage.organizational.comingSoon' | translate }}</p>
      </div>
    </div>

         <!-- Documents Tab -->
     <div *ngIf="activeTabIndex === 3" class="tab-content">
       <h3 class="text-lg font-medium mb-6 text-gray-900 text-center">{{ 'employees.formPage.documents.title' | translate }}</h3>
       <div formGroupName="document" class="grid grid-cols-1 md:grid-cols-2 gap-8">
         
         <div class="field">
           <label for="passportNumber" class="block text-sm font-medium mb-2 text-gray-700">
             {{ 'employees.formPage.documents.labels.passportNumber' | translate }}
           </label>
           <input 
             id="passportNumber"
             pInputText 
             formControlName="passportNumber"
             [placeholder]="'employees.formPage.placeholders.passportNumber' | translate"
             class="w-full">
         </div>

         <div class="field">
           <label for="visaNumber" class="block text-sm font-medium mb-2 text-gray-700">
             {{ 'employees.formPage.documents.labels.visaNumber' | translate }}
           </label>
           <input 
             id="visaNumber"
             pInputText 
             formControlName="visaNumber"
             [placeholder]="'employees.formPage.placeholders.visaNumber' | translate"
             class="w-full">
         </div>

         <div class="field">
           <label for="passportExpirationDate" class="block text-sm font-medium mb-2 text-gray-700">
             {{ 'employees.formPage.documents.labels.passportExpiration' | translate }}
           </label>
           <input 
             id="passportExpirationDate"
             type="date"
             formControlName="passportExpirationDate"
             class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-red-500">
         </div>

         <div class="field">
           <label for="visaExpirationDate" class="block text-sm font-medium mb-2 text-gray-700">
             {{ 'employees.formPage.documents.labels.visaExpiration' | translate }}
           </label>
           <input 
             id="visaExpirationDate"
             type="date"
             formControlName="visaExpirationDate"
             class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-red-500">
         </div>
       </div>
     </div>

    <!-- Report Managers Tab -->
    <div *ngIf="activeTabIndex === 4" class="tab-content">
      <div class="text-center py-12">
        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="pi pi-users text-2xl text-gray-400"></i>
        </div>
        <h3 class="text-lg font-medium text-gray-900 mb-2">{{ 'employees.formPage.tabs.reportManagers' | translate }}</h3>
        <p class="text-gray-500">{{ 'employees.formPage.reportManagers.comingSoon' | translate }}</p>
      </div>
    </div>

    <!-- Assign Schedule Tab -->
    <div *ngIf="activeTabIndex === 5" class="tab-content">
      <div class="mb-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-medium text-gray-900">{{ 'employees.formPage.tabs.assignSchedule' | translate }}</h3>
          <button 
            *ngIf="isEditMode"
            pButton 
            label="Add Assignment" 
            icon="pi pi-plus" 
            class="p-button-sm"
            type="button"
            (click)="openShiftAssignmentModal($event)"
          ></button>
        </div>
        
        <!-- Shift Assignments Table -->
        <div *ngIf="isEditMode" class="shift-assignments-section">
          <p-table
            #dt
            [value]="shiftAssignments"
            dataKey="id"
            [rows]="5"
            [loading]="loadingShiftAssignments"
            [rowHover]="true"
            [showGridlines]="true"
            [paginator]="true"
            [globalFilterFields]="['shift.name', 'priority', 'startDateTime']"
            responsiveLayout="scroll"
          >
            <ng-template pTemplate="header">
              <tr>
                <th style="min-width: 12rem">Shift</th>
                <th style="min-width: 10rem">Type</th>
                <th style="min-width: 12rem">From Date</th>
                <th style="min-width: 12rem">To Date</th>
                <th style="min-width: 8rem">Status</th>
                <th style="min-width: 8rem">Actions</th>
              </tr>
            </ng-template>
            
            <ng-template pTemplate="body" let-assignment>
              <tr>
                <td>{{ assignment.shift?.name || 'N/A' }}</td>
                <td>
                  <p-tag 
                    [value]="getPriorityLabel(assignment.priority)" 
                    [severity]="getPrioritySeverity(assignment.priority)"
                  ></p-tag>
                </td>
                <td>{{ assignment.startDateTime ? (assignment.startDateTime | date:'shortDate') : 'N/A' }}</td>
                <td>{{ assignment.endDateTime ? (assignment.endDateTime | date:'shortDate') : 'N/A' }}</td>
                <td>
                  <p-tag 
                    [value]="getStatusLabel(assignment.isCurrent)" 
                    [severity]="getSeverity(assignment.isCurrent)"
                  ></p-tag>
                </td>
                <td>
                  <div class="action-buttons">
                    <button 
                      pButton 
                      icon="pi pi-pencil" 
                      class="p-button-rounded p-button-text p-button-sm"
                      type="button"
                      (click)="editShiftAssignment(assignment, $event)"
                      pTooltip="Edit Assignment"
                      tooltipPosition="top"
                    ></button>
                    <button 
                      pButton 
                      icon="pi pi-trash" 
                      class="p-button-rounded p-button-text p-button-danger p-button-sm"
                      type="button"
                      (click)="deleteShiftAssignment(assignment, $event)"
                      pTooltip="Delete Assignment"
                      tooltipPosition="top"
                    ></button>
                  </div>
                </td>
              </tr>
            </ng-template>
            
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="6">No shift assignments found</td>
              </tr>
            </ng-template>
            
            <ng-template pTemplate="loadingbody">
              <tr>
                <td colspan="6">Loading shift assignments...</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
        
        <!-- Message for new employees -->
        <div *ngIf="!isEditMode" class="bg-gray-50 rounded-lg p-6">
          <div class="text-center">
            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="pi pi-calendar text-2xl text-blue-600"></i>
            </div>
            <h4 class="text-lg font-medium text-gray-900 mb-2">Shift Assignment Management</h4>
            <p class="text-gray-600 mb-4">
              Save the employee first to manage shift assignments.
            </p>
            <button 
              pButton 
              label="Save Employee First" 
              icon="pi pi-save" 
              class="p-button-outlined p-button-sm"
              disabled
            ></button>
          </div>
        </div>
      </div>
    </div>

    <!-- Shift Assignment Modal -->
    <p-dialog 
      [(visible)]="shiftAssignmentDialogVisible" 
      [header]="(isEditShiftAssignment ? 'Edit Shift Assignment' : 'Add Shift Assignment')"
      [modal]="true" 
      [style]="{width: '60vw'}"
      [draggable]="false" 
      [resizable]="false"
      [closable]="false"
      [dismissableMask]="false"
      (onHide)="closeShiftAssignmentDialog()"
      [closeOnEscape]="true"
    >
      <!-- Custom Close Button -->
      <ng-template pTemplate="header">
        <div class="flex justify-between items-center w-full">
          <span class="text-lg font-semibold">{{ isEditShiftAssignment ? 'Edit Shift Assignment' : 'Add Shift Assignment' }}</span>
          <button 
            type="button"
            (click)="closeShiftAssignmentDialog($event)"
            class="close-button"
            title="Close">
            <i class="pi pi-times"></i>
          </button>
        </div>
      </ng-template>
      
      <form [formGroup]="shiftAssignmentForm" (ngSubmit)="onShiftAssignmentSubmit($event)">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
          
          <!-- Type Selection -->
          <div class="field md:col-span-2">
            <label class="block text-sm font-medium mb-2 text-gray-700">
              Type <span class="text-red-500">*</span>
            </label>
            <div class="flex gap-4">
              <div class="flex items-center">
                <input 
                  type="radio"
                  id="temporary"
                  name="priority"
                  [value]="0"
                  formControlName="priority"
                  class="mr-2 h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300">
                <label for="temporary" class="text-sm text-gray-700">Temporary</label>
              </div>
              <div class="flex items-center">
                <input 
                  type="radio"
                  id="permanent"
                  name="priority"
                  [value]="1"
                  formControlName="priority"
                  class="mr-2 h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300">
                <label for="permanent" class="text-sm text-gray-700">Permanent</label>
              </div>
            </div>
            <small class="text-red-500" *ngIf="shiftAssignmentForm.get('priority')?.invalid && shiftAssignmentForm.get('priority')?.touched">
              Type is required
            </small>
          </div>

          <!-- Day Selection - Only for Temporary -->
          <div class="field md:col-span-2" *ngIf="shiftAssignmentForm.get('priority')?.value === 0">
            <label class="block text-sm font-medium mb-2 text-gray-700">Days</label>
            <div class="grid grid-cols-7 gap-2">
              <div *ngFor="let day of weekdays" class="flex items-center">
                <input 
                  type="checkbox"
                  [id]="day.value"
                  [value]="day.value"
                  (change)="onDayChange($event)"
                  [checked]="selectedDays.includes(day.value)"
                  class="mr-2 h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded">
                <label [for]="day.value" class="text-sm text-gray-700">{{ day.label }}</label>
              </div>
            </div>
          </div>

          <!-- From Date -->
          <div class="field">
            <label for="startDateTime" class="block text-sm font-medium mb-2 text-gray-700">
              From date <span class="text-red-500">*</span>
            </label>
            <div class="relative">
              <input 
                id="startDateTime"
                type="date"
                formControlName="startDateTime"
                class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-red-500"
                [class.ng-invalid]="shiftAssignmentForm.get('startDateTime')?.invalid && shiftAssignmentForm.get('startDateTime')?.touched">
            </div>
            <small class="text-red-500" *ngIf="shiftAssignmentForm.get('startDateTime')?.invalid && shiftAssignmentForm.get('startDateTime')?.touched">
              From date is required
            </small>
          </div>

          <!-- To Date - Only for Temporary -->
          <div class="field" *ngIf="shiftAssignmentForm.get('priority')?.value === 0">
            <label for="endDateTime" class="block text-sm font-medium mb-2 text-gray-700">
              To date <span class="text-red-500">*</span>
            </label>
            <div class="relative">
              <input 
                id="endDateTime"
                type="date"
                formControlName="endDateTime"
                class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-red-500"
                [class.ng-invalid]="shiftAssignmentForm.get('endDateTime')?.invalid && shiftAssignmentForm.get('endDateTime')?.touched">
            </div>
            <small class="text-red-500" *ngIf="shiftAssignmentForm.get('endDateTime')?.invalid && shiftAssignmentForm.get('endDateTime')?.touched">
              To date is required
            </small>
          </div>

          <!-- Shift Selection -->
          <div class="field">
            <label for="shiftId" class="block text-sm font-medium mb-2 text-gray-700">
              Shift <span class="text-red-500">*</span>
            </label>
            <p-select 
              id="shiftId"
              formControlName="shiftId"
              placeholder="Select shift"
              [options]="shifts"
              optionLabel="name"
              optionValue="id"
              class="w-full"
              [class.ng-invalid]="shiftAssignmentForm.get('shiftId')?.invalid && shiftAssignmentForm.get('shiftId')?.touched">
            </p-select>
            <small class="text-red-500" *ngIf="shiftAssignmentForm.get('shiftId')?.invalid && shiftAssignmentForm.get('shiftId')?.touched">
              Shift is required
            </small>
          </div>

          <!-- Attachment -->
          <div class="field">
            <label class="block text-sm font-medium mb-2 text-gray-700">Attachment</label>
            <div class="flex items-center gap-2">
              <input 
                type="file"
                #fileInput
                (change)="onFileSelect($event)"
                accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
                class="hidden">
              <button 
                type="button"
                pButton 
                label="Choose File" 
                class="p-button-outlined p-button-sm"
                (click)="fileInput.click()">
              </button>
              <span class="text-sm text-gray-500">{{ selectedFileName || 'No file chosen' }}</span>
            </div>
          </div>

          <!-- Additional Options - Only for Temporary -->
          <div class="field md:col-span-2" *ngIf="shiftAssignmentForm.get('priority')?.value === 0">
            <div class="flex items-center gap-6">
              <div class="flex items-center">
                <input 
                  type="checkbox"
                  id="isOtShift"
                  formControlName="isOtShift"
                  class="mr-3 h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded">
                <label for="isOtShift" class="text-sm text-gray-700">Overtime Shift</label>
              </div>

              <div class="flex items-center">
                <input 
                  type="checkbox"
                  id="isOverwriteHolidays"
                  formControlName="isOverwriteHolidays"
                  class="mr-3 h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded">
                <label for="isOverwriteHolidays" class="text-sm text-gray-700">Overwrite holidays</label>
              </div>

              <div class="flex items-center">
                <input 
                  type="checkbox"
                  id="isPunchNotRequired"
                  formControlName="isPunchNotRequired"
                  class="mr-3 h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded">
                <label for="isPunchNotRequired" class="text-sm text-gray-700">Punch not required</label>
              </div>
            </div>
          </div>
        </div>

        <div class="flex justify-end gap-3 mt-6 pt-4 border-t">
          <button 
            pButton 
            label="Cancel" 
            class="p-button-secondary" 
            type="button"
            (click)="closeShiftAssignmentDialog($event)">
          </button>
          <button 
            pButton 
            label="{{ isEditShiftAssignment ? 'Update' : 'Add' }}" 
            class="p-button-danger" 
            [loading]="loadingShiftAssignment"
            type="submit">
          </button>
        </div>
      </form>
    </p-dialog>

    <!-- Confirmation Dialog -->
    <p-confirmDialog></p-confirmDialog>

    <!-- Custom Delete Confirmation Dialog -->
    <p-dialog 
      [(visible)]="deleteConfirmationVisible" 
      [modal]="true" 
      [style]="{width: '400px'}"
      [draggable]="false" 
      [resizable]="false"
      [closable]="false"
      [dismissableMask]="false"
    >
      <!-- Custom Close Button for Delete Dialog -->
      <ng-template pTemplate="header">
        <div class="flex justify-between items-center w-full">
          <span class="text-lg font-semibold">Confirm Deletion</span>
          <button 
            type="button"
            (click)="cancelDelete($event)"
            class="close-button"
            title="Close">
            <i class="pi pi-times"></i>
          </button>
        </div>
      </ng-template>
      <div class="flex items-center gap-3 mb-4">
        <i class="pi pi-exclamation-triangle text-orange-500 text-2xl"></i>
        <span>Are you sure you want to delete this shift assignment?</span>
      </div>
      
      <div class="flex justify-end gap-3">
        <button 
          pButton 
          label="No" 
          class="p-button-secondary" 
          type="button"
          (click)="cancelDelete()">
        </button>
        <button 
          pButton 
          label="Yes" 
          class="p-button-danger" 
          type="button"
          (click)="confirmDelete()">
        </button>
      </div>
    </p-dialog>

    <!-- Policies Tab -->
    <div *ngIf="activeTabIndex === 6" class="tab-content">
      <div class="text-center py-12">
        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="pi pi-shield text-2xl text-gray-400"></i>
        </div>
        <h3 class="text-lg font-medium text-gray-900 mb-2">{{ 'employees.formPage.tabs.policies' | translate }}</h3>
        <p class="text-gray-500">{{ 'employees.formPage.policies.comingSoon' | translate }}</p>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="flex justify-between gap-3 mt-8 pt-6 border-t border-gray-200">
      <div class="flex gap-3">
        <button 
          pButton 
          [label]="'employees.formPage.buttons.cancel' | translate" 
          class="p-button-secondary" 
          type="button"
          (click)="onBack($event)">
        </button>
        <button 
          pButton 
          [label]="'employees.formPage.buttons.previous' | translate" 
          icon="pi pi-arrow-left"
          class="p-button-outlined" 
          type="button"
          [disabled]="activeTabIndex === 0"
          (click)="onPreviousTab($event)">
        </button>
        <button 
          pButton 
          [label]="'employees.formPage.buttons.next' | translate" 
          icon="pi pi-arrow-right"
          iconPos="right"
          class="p-button-outlined" 
          type="button"
          [disabled]="activeTabIndex === 6"
          (click)="onNextTab($event)">
        </button>
      </div>
      <button 
        pButton 
        [label]="(isEditMode ? 'employees.formPage.buttons.update' : 'employees.formPage.buttons.create') | translate"
        class="p-button-danger" 
        [loading]="loading"
        type="submit">
      </button>
    </div>
  </form>
</div>

<p-toast></p-toast>