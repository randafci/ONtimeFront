<div class="card p-fluid max-w-[800px] mx-auto">
  <!-- 1. Translated Title -->
  <h2>{{ (isEditMode ? 'departmentForm.title.edit' : 'departmentForm.title.add') | translate }}</h2>
  
  <form [formGroup]="departmentForm" (ngSubmit)="onSubmit()" class="flex flex-col gap-6">
    <!-- Vertical Grid Layout -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Code Field -->
      <div class="field">
        <!-- 2. Translated Label -->
        <label for="code">{{ 'departmentForm.labels.code' | translate }} <span class="required-star">*</span></label>
        <input 
          id="code" 
          type="text" 
          pInputText 
          class="w-full"
          formControlName="code" 
          [ngClass]="{
            'field-error': 
              (departmentForm.controls['code'].invalid && 
              (departmentForm.controls['code'].dirty || departmentForm.controls['code'].touched || submitted))
          }"
        />
        <!-- 3. Translated Validation Message -->
        <small 
          *ngIf="departmentForm.controls['code'].invalid && 
                (departmentForm.controls['code'].dirty || departmentForm.controls['code'].touched || submitted)" 
          class="p-error"
        >
          {{ 'departmentForm.validation.required' | translate }}
        </small>
      </div>

      <!-- Name Field -->
      <div class="field">
        <label for="name">{{ 'departmentForm.labels.name' | translate }} <span class="required-star">*</span></label>
        <input class="w-full"
          id="name" 
          type="text" 
          pInputText 
          formControlName="name" 
          [ngClass]="{
            'field-error': 
              (departmentForm.controls['name'].invalid && 
              (departmentForm.controls['name'].dirty || departmentForm.controls['name'].touched || submitted))
          }"
        />
        <small 
          *ngIf="departmentForm.controls['name'].invalid && 
                (departmentForm.controls['name'].dirty || departmentForm.controls['name'].touched || submitted)" 
          class="p-error"
        >
          {{ 'departmentForm.validation.required' | translate }}
        </small>
      </div>

      <!-- NameSE Field -->
      <div class="field">
        <label for="nameSE">{{ 'departmentForm.labels.nameSE' | translate }} <span class="required-star">*</span></label>
        <input class="w-full"
          id="nameSE" 
          type="text" 
          pInputText 
          formControlName="nameSE" 
          [ngClass]="{
            'field-error': 
              (departmentForm.controls['nameSE'].invalid && 
              (departmentForm.controls['nameSE'].dirty || departmentForm.controls['nameSE'].touched || submitted))
          }"
        />
        <small 
          *ngIf="departmentForm.controls['nameSE'].invalid && 
                (departmentForm.controls['nameSE'].dirty || departmentForm.controls['nameSE'].touched || submitted)" 
          class="p-error"
        >
          {{ 'departmentForm.validation.required' | translate }}
        </small>
      </div>

      <!-- Organization Field -->
      <div class="field">
        <label for="organizationId">{{ 'departmentForm.labels.organization' | translate }} <span class="required-star">*</span></label>
        <p-select class="w-full"
          id="organizationId" 
          formControlName="organizationId" 
          [options]="organizations" 
          optionLabel="name" 
          optionValue="id"
          [placeholder]="'departmentForm.placeholders.selectOrganization' | translate"
          [ngClass]="{
            'field-error': 
              (departmentForm.controls['organizationId'].invalid && 
              (departmentForm.controls['organizationId'].dirty || departmentForm.controls['organizationId'].touched || submitted))
          }"
        ></p-select>
        <small 
          *ngIf="departmentForm.controls['organizationId'].invalid && 
                (departmentForm.controls['organizationId'].dirty || departmentForm.controls['organizationId'].touched || submitted)" 
          class="p-error"
        >
          {{ 'departmentForm.validation.required' | translate }}
        </small>
      </div>

      <!-- Department Type Field -->
      <div class="field">
        <label for="departmentTypeId">{{ 'departmentForm.labels.departmentType' | translate }} <span class="required-star">*</span></label>
        <p-select class="w-full"
          id="departmentTypeId" 
          formControlName="departmentTypeId" 
          [options]="departmentTypes" 
          optionLabel="name" 
          optionValue="id"
          [placeholder]="'departmentForm.placeholders.selectDepartmentType' | translate"
          [ngClass]="{
            'field-error': 
              (departmentForm.controls['departmentTypeId'].invalid && 
              (departmentForm.controls['departmentTypeId'].dirty || departmentForm.controls['departmentTypeId'].touched || submitted))
          }"
        ></p-select>
        <small 
          *ngIf="departmentForm.controls['departmentTypeId'].invalid && 
                (departmentForm.controls['departmentTypeId'].dirty || departmentForm.controls['departmentTypeId'].touched || submitted)" 
          class="p-error"
        >
          {{ 'departmentForm.validation.required' | translate }}
        </small>
      </div>

      <!-- Company Field -->
      <div class="field">
        <label for="companyId">{{ 'departmentForm.labels.company' | translate }}</label>
        <p-select class="w-full"
          id="companyId" 
          formControlName="companyId" 
          [options]="companies" 
          optionLabel="name" 
          optionValue="id"
          [placeholder]="'departmentForm.placeholders.selectCompany' | translate"
        ></p-select>
      </div>

      <!-- Parent Department Field - Only shown for Sub Departments -->
      <div class="field" *ngIf="departmentForm.get('departmentTypeId')?.value === 2">
        <label for="parentId">{{ 'departmentForm.labels.parentDepartment' | translate }}</label>
        <p-select class="w-full"
          id="parentId" 
          formControlName="parentId" 
          [options]="mainDepartments" 
          optionLabel="name" 
          optionValue="id"
          [placeholder]="'departmentForm.placeholders.selectParent' | translate"
        ></p-select>
      </div>
    </div>

    <!-- Submit Button Row -->
    <div class="flex justify-content-start gap-2 mt-4">
      <!-- 4. Translated Buttons -->
      <button 
        pButton 
        type="button" 
        [label]="'departmentForm.buttons.cancel' | translate" 
        class="p-button-secondary" 
        (click)="onCancel()"
        [disabled]="loading"
      ></button>
      <button 
        pButton 
        type="submit" 
        [label]="(isEditMode ? 'departmentForm.buttons.update' : 'departmentForm.buttons.save') | translate" 
        [disabled]="departmentForm.invalid || loading"
      ></button>
    </div>
  </form>
</div>

<p-toast></p-toast>