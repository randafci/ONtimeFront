<div class="card">
  <div class="flex justify-between items-center mb-4">
    <h1 class="font-semibold text-xl mb-0">
      {{ 'permissions.pageTitle' | translate }}
    </h1>
    <button
      pButton
      [label]="'common.backButton' | translate"
      icon="pi pi-arrow-left"
      class="p-button-sm"
      (click)="navigateToRoleList()"
    ></button>
  </div>

  <div class="container mx-auto p-6">
    <!-- Role Name -->
    <div class="mb-6">
      <h2 class="text-xl font-semibold">{{ 'permissions.roleLabel' | translate }}: {{ roleName }}</h2>
    </div>

    <!-- Select All -->
    <div class="flex items-center mb-6">
      <p-checkbox 
        [(ngModel)]="selectAll" 
        binary="true" 
        inputId="selectAll"
        (onChange)="toggleAllPermissions()">
      </p-checkbox>
      <label for="selectAll" class="ml-2 font-semibold">{{ 'common.selectAll' | translate }}</label>
    </div>

    <!-- Plain Permission Groups -->
    <div class="space-y-6 mb-8">
      <div *ngFor="let group of permissionGroups" class="border p-4 rounded-lg shadow-sm">
        <div class="flex items-center mb-4">
          <p-checkbox 
            [(ngModel)]="group.isSelected" 
            binary="true" 
            [inputId]="'group-' + group.entityName"
            (onChange)="onGroupToggle(group)">
          </p-checkbox>
          <label [for]="'group-' + group.entityName" class="ml-2 font-semibold text-lg">
            {{ formatDisplayName(group.entityName) }}
          </label>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
          <div *ngFor="let perm of group.permissionsList; let i = index" class="flex items-center">
            <p-checkbox 
              *ngIf="perm.displayValue"
              [(ngModel)]="perm.isSelected" 
              binary="true" 
              [inputId]="'perm-' + group.entityName + '-' + i"
              (onChange)="onPermissionChange(group)">
            </p-checkbox>
            <label *ngIf="perm.displayValue" [for]="'perm-' + group.entityName + '-' + i" class="ml-2">
              {{ formatDisplayName(perm.displayValue) }}
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- CRUD Permissions Table -->
    <div class="mb-8">
      <h3 class="text-lg font-semibold mb-4">{{ 'permissions.crudPermissions' | translate }}</h3>
      
      <p-table [value]="crudPermissionGroups" [tableStyle]="{'min-width': '50rem'}">
        <ng-template pTemplate="header">
          <tr>
            <th>{{ 'permissions.headers.entity' | translate }}</th>
            <th>{{ 'permissions.headers.page' | translate }}</th>
            <th>{{ 'permissions.headers.view' | translate }}</th>
            <th>{{ 'permissions.headers.create' | translate }}</th>
            <th>{{ 'permissions.headers.edit' | translate }}</th>
            <th>{{ 'permissions.headers.delete' | translate }}</th>
            <th>{{ 'common.selectAll' | translate }}</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-group>
          <tr>
            <td class="font-semibold">{{ formatDisplayName(group.entityName) }}</td>
            <td *ngFor="let perm of group.permissionsList; let i = index">
              <p-checkbox 
                *ngIf="perm.displayValue"
                [(ngModel)]="perm.isSelected" 
                binary="true" 
                [inputId]="'crud-' + group.entityName + '-' + i"
                (onChange)="onCrudPermissionChange(group, i)">
              </p-checkbox>
            </td>
            <td>
              <p-checkbox 
                [(ngModel)]="group.isSelected" 
                binary="true" 
                [inputId]="'crud-group-' + group.entityName"
                (onChange)="onCrudGroupToggle(group)">
              </p-checkbox>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>

    <!-- Action Buttons -->
    <div class="flex justify-end space-x-4 mt-8">
      <button pButton type="button" [label]="'common.buttons.cancel' | translate" class="p-button-outlined" (click)="navigateToRoleList()"></button>
      <button pButton type="button" [label]="'common.buttons.save' | translate" class="p-button-primary" (click)="savePermissions()"></button>
    </div>
  </div>
</div>