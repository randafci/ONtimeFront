<p-toast></p-toast>
<div class="card">
    <!-- Header -->
    <div class="flex justify-content-between align-items-center mb-5 border-bottom-1 pb-3">
        <h1 class="font-semibold text-xl m-0">
            {{ (isEditMode ? 'devices.editForm.pageTitle' : 'devices.addForm.pageTitle') | translate }}
        </h1>
        <button
            pButton pRipple
            [label]="'common.backButton' | translate"
            icon="pi pi-arrow-left"
            class="p-button-text p-button-secondary"
            routerLink="/devices">
        </button>
    </div>

    <!-- Form -->
    <form [formGroup]="deviceForm" (ngSubmit)="onSubmit()">
        <div class="grid p-fluid">
            <!-- Code Field -->
            <div class="field col-12 md:col-6">
                <label for="code">{{ 'devices.form.labels.code' | translate }} <span class="required-star">*</span></label>
                <input 
                  id="code" 
                  pInputText 
                  formControlName="code"
                  [ngClass]="{'field-error': f['code'].invalid && (f['code'].touched || submitted)}"
                />
                <small *ngIf="f['code'].invalid && (f['code'].touched || submitted)" class="p-error block mt-1">
                  {{ 'common.validation.required' | translate }}
                </small>
            </div>

            <!-- Name Field -->
            <div class="field col-12 md:col-6">
                <label for="name">{{ 'devices.form.labels.name' | translate }} <span class="required-star">*</span></label>
                <input 
                  id="name" 
                  pInputText 
                  formControlName="name"
                  [ngClass]="{'field-error': f['name'].invalid && (f['name'].touched || submitted)}"
                />
                <small *ngIf="f['name'].invalid && (f['name'].touched || submitted)" class="p-error block mt-1">
                  {{ 'common.validation.required' | translate }}
                </small>
            </div>

            <!-- IP Address Field -->
            <div class="field col-12 md:col-6">
                <label for="ipAddress">{{ 'devices.form.labels.ipAddress' | translate }} <span class="required-star">*</span></label>
                <input 
                  id="ipAddress" 
                  pInputText 
                  formControlName="ipAddress"
                  [ngClass]="{'field-error': f['ipAddress'].invalid && (f['ipAddress'].touched || submitted)}"
                />
                <small *ngIf="f['ipAddress'].invalid && (f['ipAddress'].touched || submitted)" class="p-error block mt-1">
                  {{ 'common.validation.required' | translate }}
                </small>
            </div>

            <!-- Location Field -->
            <div class="field col-12 md:col-6">
                <label for="locationId">{{ 'devices.form.labels.location' | translate }} <span class="required-star">*</span></label>
                <p-select 
                  id="locationId" 
                  formControlName="locationId" 
                  [options]="locationsList" 
                  [placeholder]="'devices.form.placeholders.location' | translate" 
                  optionLabel="name" 
                  optionValue="id"
                  [ngClass]="{'field-error': f['locationId'].invalid && (f['locationId'].touched || submitted)}"
                ></p-select>
                <small *ngIf="f['locationId'].invalid && (f['locationId'].touched || submitted)" class="p-error block mt-1">
                  {{ 'common.validation.required' | translate }}
                </small>
            </div>

            <!-- Organization Field -->
            <div class="field col-12 md:col-6" *ngIf="isSuperAdmin">
                <label for="organizationId">{{ 'devices.form.labels.organization' | translate }} <span class="required-star">*</span></label>
                <p-select
                    id="organizationId"
                    formControlName="organizationId"
                    [options]="organizations"
                    optionLabel="name"
                    optionValue="id"
                    [placeholder]="'devices.form.placeholders.organization' | translate"
                    [ngClass]="{'field-error': f['organizationId'].invalid && (f['organizationId'].touched || submitted)}">
                </p-select>
                <small *ngIf="f['organizationId'].invalid && (f['organizationId'].touched || submitted)" class="p-error block mt-1">
                    {{ 'common.validation.required' | translate }}
                </small>
            </div>

            <!-- THE CORRECTED CHECKBOX STRUCTURE -->
            <!-- Disabled Checkbox -->
            <div class="field col-12 md:col-6">
                <div class="field-checkbox-container">
                    <p-checkbox formControlName="disabled" [binary]="true" inputId="disabled"></p-checkbox>
                    <label for="disabled" class="ml-2 mb-0">{{ 'devices.form.labels.disabled' | translate }}</label>
                </div>
            </div>

            <!-- Download Logs Checkbox -->
            <div class="field col-12 md:col-6">
                <div class="field-checkbox-container">
                    <p-checkbox formControlName="download" [binary]="true" inputId="download"></p-checkbox>
                    <label for="download" class="ml-2 mb-0">{{ 'devices.form.labels.downloadLogs' | translate }}</label>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-content-start gap-2 mt-5">
            <button 
                pButton pRipple
                type="button" 
                [label]="'common.buttons.cancel' | translate" 
                class="p-button-secondary" 
                (click)="onCancel()" 
                [disabled]="isSaving">
            </button>
            <button pButton pRipple type="submit" [disabled]="isSaving">
                <span *ngIf="!isSaving">{{ (isEditMode ? 'devices.editForm.buttons.update' : 'devices.addForm.buttons.add') | translate }}</span>
                <span *ngIf="isSaving"><i class="pi pi-spin pi-spinner mr-2"></i> {{ (isEditMode ? 'devices.editForm.buttons.updating' : 'devices.addForm.buttons.adding') | translate }}</span>
            </button>
        </div>
    </form>
</div>