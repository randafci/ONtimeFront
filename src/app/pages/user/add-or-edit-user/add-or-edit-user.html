<div class="card p-fluid max-w-[800px] mx-auto">
  <div class="flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">{{(isEditMode ? 'users.formPage.title.edit' : 'users.formPage.title.add') | translate }}</h2>
    <button pButton type="button" [label]="'common.backButton' | translate" class="p-button-text"
      routerLink="/users"></button>
  </div>

  <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="flex flex-col gap-4">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

      <!-- isLdapUser Toggle -->
      <div class="field col-span-2">
        <label for="isLdapUser" class="block mb-2">{{ 'users.formPage.labels.isLdapUser' | translate }}</label>
        <p-toggleButton id="isLdapUser" formControlName="isLdapUser" [onLabel]="'common.yes' | translate"
          [offLabel]="'common.no' | translate">
        </p-toggleButton>
      </div>

      <!-- Username -->
      <div class="field" *ngIf="!userForm.get('isLdapUser')?.value">
        <label for="userName">
          {{ 'users.formPage.labels.userName' | translate }}
          <span class="required-star">*</span>
        </label>

        <input id="userName" type="text" pInputText class="w-full" formControlName="userName"
          [ngClass]="{'field-error': userForm.controls['userName'].invalid && (userForm.controls['userName'].touched || submitted)}" />

        <!-- Required -->
        <small
          *ngIf="userForm.controls['userName'].errors?.['required'] && (userForm.controls['userName'].touched || submitted)"
          class="p-error">
          {{ 'common.validation.required' | translate }}
        </small>

        <!-- Email format -->
        <small
          *ngIf="userForm.controls['userName'].errors?.['email'] && (userForm.controls['userName'].touched || submitted)"
          class="p-error">
          {{ 'users.formPage.validation.email' | translate }}
        </small>

        <!-- Min length -->
        <small
          *ngIf="userForm.controls['userName'].errors?.['minlength'] && (userForm.controls['userName'].touched || submitted)"
          class="p-error">
          {{ 'users.formPage.validation.minLength' | translate }}
        </small>

        <!-- Max length -->
        <small
          *ngIf="userForm.controls['userName'].errors?.['maxlength'] && (userForm.controls['userName'].touched || submitted)"
          class="p-error">
          {{ 'users.formPage.validation.maxLength' | translate}}
        </small>
      </div>


      <!-- Password -->
<div class="field" *ngIf="!isEditMode && !userForm.get('isLdapUser')?.value">
  <label for="password">
    {{ 'users.formPage.labels.password' | translate }}
    <span class="required-star">*</span>
  </label>

  <input id="password" type="password" pInputText class="w-full" formControlName="password"
         [ngClass]="{'field-error': userForm.controls['password'].invalid && (userForm.controls['password'].touched || submitted)}" />

  <!-- Required -->
  <small *ngIf="userForm.controls['password'].errors?.['required'] && (userForm.controls['password'].touched || submitted)" class="p-error">
    {{ 'common.validation.required' | translate }}
  </small>

  <!-- Min length -->
  <small *ngIf="userForm.controls['password'].errors?.['minlength'] && (userForm.controls['password'].touched || submitted)" class="p-error">
    {{ 'users.formPage.validation.minPasswordLength' | translate}}
  </small>

  <!-- Max length -->
  <small *ngIf="userForm.controls['password'].errors?.['maxlength'] && (userForm.controls['password'].touched || submitted)" class="p-error">
    {{ 'users.formPage.validation.maxPasswordLength' | translate }}
  </small>

  <!-- Pattern -->
  <small *ngIf="userForm.controls['password'].errors?.['pattern'] && (userForm.controls['password'].touched || submitted)" class="p-error">
    {{ 'users.formPage.validation.passwordPattern' | translate }}
  </small>
</div>


      <!-- Employee ID -->
<div class="field col-span-2">
  <label for="employeeId">
    {{ 'users.formPage.labels.employee' | translate }}
    <span *ngIf="userForm.get('isLdapUser')?.value" class="required-star">*</span>
  </label>

  <p-select
    class="w-full"
    [options]="employees"
    optionLabel="employeeCode"
    optionValue="id"
    formControlName="employeeId"
    [placeholder]="'users.formPage.placeholders.selectEmployee' | translate"
    [showClear]="true"
    [filter]="true"
    [loading]="loadingEmployees"
    [ngClass]="{
      'field-error': userForm.controls['employeeId'].invalid &&
                     (userForm.controls['employeeId'].touched || submitted)
    }">

    <ng-template let-employee pTemplate="item">
      <div>{{ employee.employeeCode }} - {{ employee.firstName }} {{ employee.lastName }}</div>
    </ng-template>
    <ng-template let-employee pTemplate="selectedItem">
      <div *ngIf="employee">
        {{ employee.employeeCode }} - {{ employee.firstName }} {{ employee.lastName }}
      </div>
    </ng-template>
  </p-select>

  <!-- Required -->
  <small
    *ngIf="userForm.controls['employeeId'].errors?.['required'] &&
           (userForm.controls['employeeId'].touched || submitted)"
    class="p-error">
    {{ 'common.validation.required' | translate }}
  </small>
</div>

      <!-- Organization ID -->
      <div class="field col-span-2" *ngIf="isSuperAdmin">
        <label for="organizationId">{{ 'users.formPage.labels.organization' | translate }}</label>
        <p-select class="w-full" [options]="organizations" optionLabel="name" optionValue="id"
          formControlName="organizationId" [placeholder]="'users.formPage.placeholders.selectOrganization' | translate"
          [showClear]="true" [filter]="true" [loading]="loadingOrganizations">
        </p-select>
      </div>

      <!-- Extra Employees View -->
      <div class="field col-span-2">
        <label for="extraEmployeesView">{{ 'users.formPage.labels.extraEmployeesView' | translate }}</label>
        <input id="extraEmployeesView" type="text" pInputText class="w-full" formControlName="extraEmployeesView" />
      </div>
    </div>

    <!-- Buttons -->
    <div class="flex justify-content-start gap-2 mt-4">
      <p-button type="button" [label]="'common.buttons.cancel' | translate" class="p-button-secondary"
        (click)="onCancel()" [disabled]="loading"></p-button>
      <p-button type="submit" [label]="(isEditMode ? 'common.buttons.update' : 'common.buttons.save') | translate"
        [disabled]="userForm.invalid || loading">
      </p-button>
    </div>
  </form>
</div>

<p-toast></p-toast>