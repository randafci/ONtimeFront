<div class="card p-fluid max-w-[800px] mx-auto">
  <div class="flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">{{(isEditMode ? 'users.formPage.title.edit' : 'users.formPage.title.add') | translate }}</h2>
    <button pButton type="button" [label]="'common.backButton' | translate" class="p-button-text" routerLink="/users"></button>
  </div>

  <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="flex flex-col gap-4">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

      <!-- isLdapUser Toggle -->
      <div class="field col-span-2">
        <label for="isLdapUser" class="block mb-2">{{ 'users.formPage.labels.isLdapUser' | translate }}</label>
        <p-toggleButton id="isLdapUser" formControlName="isLdapUser" 
                        [onLabel]="'common.yes' | translate" 
                        [offLabel]="'common.no' | translate">
        </p-toggleButton>
      </div>
      
      <!-- Username -->
      <div class="field" *ngIf="!userForm.get('isLdapUser')?.value">
        <label for="userName">{{ 'users.formPage.labels.userName' | translate }} <span class="required-star">*</span></label>
        <input id="userName" type="text" pInputText class="w-full" formControlName="userName"
               [ngClass]="{'field-error': userForm.controls['userName'].invalid && (userForm.controls['userName'].touched || submitted)}" />
        <small *ngIf="userForm.controls['userName'].invalid && (userForm.controls['userName'].touched || submitted)" class="p-error">
          {{ 'common.validation.required' | translate }}
        </small>
      </div>

      <!-- Email -->
      <div class="field" *ngIf="!userForm.get('isLdapUser')?.value">
        <label for="email">{{ 'users.formPage.labels.email' | translate }} <span class="required-star">*</span></label>
        <input id="email" type="email" pInputText class="w-full" formControlName="email"
               [ngClass]="{'field-error': userForm.controls['email'].invalid && (userForm.controls['email'].touched || submitted)}" />
        <small *ngIf="userForm.controls['email'].hasError('required') && (userForm.controls['email'].touched || submitted)" class="p-error">
          {{ 'common.validation.required' | translate }}
        </small>
        <small *ngIf="userForm.controls['email'].hasError('email') && (userForm.controls['email'].touched || submitted)" class="p-error">
          {{ 'users.formPage.validation.invalidEmail' | translate }}
        </small>
      </div>

      <!-- Password -->
      <div class="field" *ngIf="!isEditMode">
        <label for="password">{{ 'users.formPage.labels.password' | translate }} <span class="required-star">*</span></label>
        <input id="password" type="password" pInputText class="w-full" formControlName="password"
               [ngClass]="{'field-error': userForm.controls['password'].invalid && (userForm.controls['password'].touched || submitted)}" />
        <small *ngIf="userForm.controls['password'].invalid && (userForm.controls['password'].touched || submitted)" class="p-error">
          {{ 'common.validation.required' | translate }}
        </small>
      </div>

      <!-- Employee ID -->
      <div class="field col-span-2">
        <label for="employeeId">{{ 'users.formPage.labels.employee' | translate }}</label>
        <p-select 
          class="w-full"
          [options]="employees" 
          optionLabel="employeeCode" 
          optionValue="id" 
          formControlName="employeeId"
          [placeholder]="'users.formPage.placeholders.selectEmployee' | translate" 
          [showClear]="true" 
          [filter]="true"
          [loading]="loadingEmployees">
          <ng-template let-employee pTemplate="item">
            <div>{{ employee.employeeCode }} - {{ employee.firstName }} {{ employee.lastName }}</div>
          </ng-template>
          <ng-template let-employee pTemplate="selectedItem">
            <div *ngIf="employee">{{ employee.employeeCode }} - {{ employee.firstName }} {{ employee.lastName }}</div>
          </ng-template>
        </p-select>
      </div>

      <!-- Organization ID -->
      <div class="field col-span-2" *ngIf="isSuperAdmin">
        <label for="organizationId">{{ 'users.formPage.labels.organization' | translate }}</label>
        <p-select 
          class="w-full"
          [options]="organizations" 
          optionLabel="name" 
          optionValue="id" 
          formControlName="organizationId"
          [placeholder]="'users.formPage.placeholders.selectOrganization' | translate" 
          [showClear]="true" 
          [filter]="true"
          [loading]="loadingOrganizations">
        </p-select>
      </div>

      <!-- Extra Employees View -->
      <div class="field col-span-2">
        <label for="extraEmployeesView">{{ 'users.formPage.labels.extraEmployeesView' | translate }}</label>
        <input id="extraEmployeesView" type="text" pInputText class="w-full" formControlName="extraEmployeesView" />
      </div>
    </div>

    <!-- Buttons -->
    <div class="flex justify-content-start gap-2 mt-4">
      <p-button type="button" [label]="'common.buttons.cancel' | translate" class="p-button-secondary"
        (click)="onCancel()" [disabled]="loading"></p-button>
      <p-button type="submit"
        [label]="(isEditMode ? 'common.buttons.update' : 'common.buttons.save') | translate"
        [disabled]="userForm.invalid || loading">
      </p-button>
    </div>
  </form>
</div>

<p-toast></p-toast>